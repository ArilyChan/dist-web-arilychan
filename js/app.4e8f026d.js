(function(e){function t(t){for(var s,o,a=t[0],c=t[1],u=t[2],d=0,f=[];d<a.length;d++)o=a[d],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&f.push(i[o][0]),i[o]=0;for(s in c)Object.prototype.hasOwnProperty.call(c,s)&&(e[s]=c[s]);l&&l(t);while(f.length)f.shift()();return r.push.apply(r,u||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],s=!0,a=1;a<n.length;a++){var c=n[a];0!==i[c]&&(s=!1)}s&&(r.splice(t--,1),e=o(o.s=n[0]))}return e}var s={},i={app:0},r=[];function o(t){if(s[t])return s[t].exports;var n=s[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=s,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)o.d(n,s,function(t){return e[t]}.bind(null,s));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var u=0;u<a.length;u++)t(a[u]);var l=c;r.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"0265":function(e,t,n){},1:function(e,t){},3141:function(e,t,n){},3981:function(e,t,n){},"3e54":function(e,t,n){"use strict";n("3981")},"431b":function(e,t,n){"use strict";n("0265")},"56d7":function(e,t,n){"use strict";n.r(t),n.d(t,"io",(function(){return U}));n("e260"),n("e6cf"),n("cca6"),n("a79d"),n("db4d");var s=n("a026"),i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"chat"}},[n("div",{staticClass:"sidebar"},[n("card"),n("list")],1),n("div",{staticClass:"main"},[n("message"),n("text-input")],1)])},r=[],o=n("5530"),a=n("2f62"),c=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"card"},[n("header",{staticStyle:{display:"flex","align-items":"self-end"}},[n("img",{staticClass:"avatar",attrs:{width:"40",height:"40",alt:e.user.name,src:e.user.img}}),n("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"name"}],staticClass:"search",attrs:{placeholder:"your id"},domProps:{value:e.name},on:{input:function(t){t.target.composing||(e.name=t.target.value)}}})]),n("footer",[n("input",{staticClass:"search",attrs:{type:"text",placeholder:"search user..."},on:{keyup:e.onKeyup}})])])},u=[],l=(n("b0c0"),n("ac1f"),n("841c"),{computed:Object(o["a"])(Object(o["a"])({},Object(a["c"])(["user"])),{},{name:{get:function(){return this.user.name},set:function(e){""===e&&(e=null),this.changeUserData({name:e})}}}),methods:Object(o["a"])(Object(o["a"])({},Object(a["b"])(["search","changeUserData"])),{},{onKeyup:function(e){this.search(e.target.value)}})}),d=l,f=(n("431b"),n("2877")),m=Object(f["a"])(d,c,u,!1,null,"6b9a1a52",null),p=m.exports,g=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"list"},[n("ul",[e._l(e.sessions,(function(t,s){return n("li",{key:s,class:{active:t.id===e.currentId},on:{click:function(n){return e.selectSession(t.id)}}},[n("img",{staticClass:"avatar",attrs:{width:"30",height:"30",alt:t.user.name,src:t.user.img}}),n("p",{staticClass:"name"},[e._v(e._s(t.user.name))])])})),n("li",{on:{click:function(t){return t.stopPropagation(),e.joinRoom()}}},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.joinRoomId,expression:"joinRoomId"}],domProps:{value:e.joinRoomId},on:{input:function(t){t.target.composing||(e.joinRoomId=t.target.value)}}}),n("p",{staticClass:"name"},[e._v("create new room")])])],2)])},v=[],h={computed:Object(o["a"])({},Object(a["c"])(["sessions","currentId"])),methods:Object(o["a"])(Object(o["a"])({},Object(a["b"])(["selectSession","createSession"])),{},{joinRoom:function(){this.$socket.emit("join-room",{room:this.joinRoomId}),this.joinRoomId=""}}),data:function(){return{joinRoomId:void 0}}},S=h,b=(n("e2e5"),Object(f["a"])(S,g,v,!1,null,"12f3ea76",null)),j=b.exports,O=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"text"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:e.content,expression:"content"}],attrs:{placeholder:"按 Ctrl + Enter 发送"},domProps:{value:e.content},on:{keyup:e.onKeyup,input:function(t){t.target.composing||(e.content=t.target.value)}}}),n("a",{attrs:{href:"#"},on:{click:function(t){return t.stopPropagation(),function(){e.content.length&&e.sendMessage(e.content)}()}}},[e._v("Send")])])},_=[],y={data:function(){return{content:""}},methods:Object(o["a"])(Object(o["a"])({},Object(a["b"])(["sendMessage"])),{},{onKeyup:function(e){e.ctrlKey&&13===e.keyCode&&this.content.length&&(this.sendMessage(this.content),this.content="")}})},C=y,E=(n("72ec"),Object(f["a"])(C,O,_,!1,null,"07706343",null)),x=E.exports,I=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"scroll-bottom",rawName:"v-scroll-bottom",value:e.session.messages,expression:"session.messages"}],staticClass:"message"},[e.session?n("ul",e._l(e.session.messages,(function(t,s){return n("li",{key:s},[0===s||new Date(t.date).getMinutes()>new Date(e.session.messages[s-1].date).getMinutes()?n("p",{staticClass:"time"},[n("span",[e._v(e._s(e._f("time")(t.date)))])]):e._e(),n("div",{staticClass:"main",class:{self:t.self}},[n("img",{staticClass:"avatar",attrs:{width:"30",height:"30",src:t.self?e.user.img:e.session.user.img}}),n("div",{staticStyle:{display:"flex","flex-direction":"column","flex-grow":"0"}},[t.self?e._e():n("span",[n("small",[e._v(e._s(t.user.name||t.user.id))])]),n("div",{staticClass:"text",staticStyle:{width:"fit-content"}},e._l(t.content.split("\n"),(function(t,s){return n("div",{key:s},[t.startsWith("[CQ:image")?n("img",{staticClass:"chat-image",attrs:{src:e.CQImageToSrc(t)}}):e.textCQCode(t)?n("p",[e._v(e._s(e.CQCodeToText(t)))]):n("p",[e._v(e._s(t))])])})),0)])])])})),0):e._e()])},w=[],T=(n("c975"),n("fb6a"),n("1276"),n("2ca0"),{computed:Object(o["a"])({},Object(a["c"])(["user","session"])),filters:{time:function(e){return"string"===typeof e&&(e=new Date(e)),e.getHours()+":"+e.getMinutes()}},methods:{CQImageToSrc:function(e){var t=e.split("file=")[1];if(t=t.split(",")[0],t=t.split("]")[0],!t.startsWith("base64://"))return t;t=t.slice(9);var n,s=window.atob(t),i=s.toLowerCase();return n=-1!==i.indexOf("png")?"png":-1!==i.indexOf("jpg")||-1!==i.indexOf("jpeg")?"jpg":"tiff","data:image/"+n+";base64,"+t},textCQCode:function(e){return e.startsWith("[CQ:")},htmlCQCode:function(e){return!1},CQCodeToText:function(e){console.log(e);var t=e.slice(4).split(",")[0];switch(t){case"at":return"@".concat(e.split("qq=")[1].split(",")[0].slice(0,-1));default:break}}}}),M=T,N=(n("3e54"),Object(f["a"])(M,I,w,!1,null,"45d5da27",null)),A=N.exports,D={components:{Card:p,List:j,TextInput:x,Message:A},methods:Object(o["a"])({},Object(a["b"])(["initData"])),created:function(){this.initData()}},R=D,K=(n("a587"),Object(f["a"])(R,i,r,!1,null,"73d9f3a7",null)),k=K.exports;n("4de4"),n("7db0"),n("caad"),n("d81d"),n("d3b7"),n("25f0"),n("2532");s["a"].use(a["a"]);var P=new a["a"].Store({state:{user:{name:"coffce",img:"images/1.jpg"},sessions:[{id:"1",type:"group",user:{name:"default-chat",img:"images/1.jpg"},messages:[]}],currentSessionId:void 0,filterKey:""},getters:{session:function(e){var t=e.sessions,n=e.currentSessionId;return t.find((function(e){return e.id===n}))},user:function(e){var t=e.user;return t},filterKey:function(e){var t=e.filterKey;return t},sessions:function(e){var t=e.sessions,n=e.filterKey,s=t.filter((function(e){return e.user.name.includes(n)}));return s},currentId:function(e){var t=e.currentSessionId;return t}},mutations:{INIT_DATA:function(e){e.sessions.map((function(e){return U.emit("join-room",{room:e.id})}));try{var t=JSON.parse(localStorage.getItem("vue-chat-session"));t&&t.map((function(t){if(!e.sessions.find((function(e){var n=e.id;return n===t.id})))return U.emit("join-room",{room:t.id})}))}catch(n){}},SEND_MESSAGE:function(e,t){var n=e.sessions,s=e.currentSessionId,i=n.find((function(e){return e.id===s}));i.messages.push({content:t,date:new Date,self:!0})},RECV_MESSAGE:function(e,t){var n=e.sessions,s=n.find((function(e){return e.id===t.id}));s.messages.push({content:t.message,date:new Date,user:t.user,self:!1})},SELECT_SESSION:function(e,t){e.currentSessionId=t},CREATE_SESSION:function(e,t){e.sessions.find((function(e){return e.id===t.id}))||e.sessions.push({id:t.id,type:t.type,user:{id:t.id,name:t.name||t.id.toString(),img:t.avatar||"images/1.jpg"},messages:[]})},SET_FILTER_KEY:function(e,t){e.filterKey=t},CHANGE_USERDATA:function(e,t){e.user=Object(o["a"])(Object(o["a"])({},e.user),t)}},actions:{initData:function(e){var t=e.commit,n=e.state,s=e.dispatch;t("INIT_DATA");var i=Object(o["a"])({},n.user);try{var r=JSON.parse(localStorage.getItem("user"));i=Object(o["a"])(Object(o["a"])({},i),r),i.id||(i.id=Math.floor(2147483647*Math.random())),localStorage.setItem("user",JSON.stringify(i)),s("changeUserData",i)}catch(a){}},changeUserData:function(e,t){var n=e.commit,s=e.state;n("CHANGE_USERDATA",t),localStorage.setItem("user",JSON.stringify(s.user))},sendMessage:function(e,t){var n=e.commit,s=e.state;console.log(s.sessions);var i=s.sessions.find((function(e){return e.id===s.currentSessionId}));U.emit("client-message",{room:i.id,message:t,user:s.user}),n("SEND_MESSAGE",t)},selectSession:function(e,t){var n=e.commit;return n("SELECT_SESSION",t)},search:function(e,t){var n=e.commit;return n("SET_FILTER_KEY",t)},reciveMessage:function(e,t){var n=e.commit;return n("RECV_MESSAGE",t)},createSession:function(e,t){var n=e.commit;return n("CREATE_SESSION",t)},"SOCKET_joined-room":function(e,t){var n=e.dispatch,s=e.state,i=t.room,r=t.type;n("createSession",{id:i,type:r}),s.currentSessionId||n("selectSession",i)},"SOCKET_client-message":function(e,t){var n=e.dispatch,s=t.room,i=t.user,r=void 0===i?{}:i,o=t.message;n("reciveMessage",{id:s,user:r,message:o})}}});P.watch((function(e){return e.sessions}),(function(e){console.log("CHANGE: ",e),localStorage.setItem("vue-chat-session",JSON.stringify(e))}),{deep:!0});var Q=P,G=n("5132"),J=n.n(G),$=n("8055"),H=n.n($);s["a"].config.devtools=!0,s["a"].directive("scroll-bottom",(function(e,t,n){n.context.$nextTick((function(){e.scrollTop=e.scrollHeight-e.clientHeight}))}));var L={},U=H()("http://141.193.21.250:3004/chat",L);s["a"].use(new J.a({debug:!0,connection:U,vuex:{store:Q,actionPrefix:"SOCKET_",mutationPrefix:"SOCKET_"}})),new s["a"]({el:"#app",components:{App:k},template:"<App/>",store:Q})},"72ec":function(e,t,n){"use strict";n("3141")},a587:function(e,t,n){"use strict";n("d723")},acfd:function(e,t,n){},d723:function(e,t,n){},e2e5:function(e,t,n){"use strict";n("acfd")}});
//# sourceMappingURL=app.4e8f026d.js.map